<!doctype html>
<html lang="zh-CN">
<head>
<link rel="apple-touch-icon" href="icons/iconmeet180.png">
<meta name="apple-mobile-web-app-title" content="è¿˜è¦å¤šä¹…æˆ‘æ‰èƒ½åœ¨ä»–èº«è¾¹ï¼Ÿ">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>è¿˜è¦å¤šä¹…æˆ‘æ‰èƒ½åœ¨ä»–èº«è¾¹ï¼Ÿ</title>

<style>
  :root{
    --text:#fff; --muted:rgba(255,255,255,.88);
    --glass:rgba(0,0,0,.12); --panel:rgba(0,0,0,.28);
    --shadow:0 12px 28px rgba(0,0,0,.45); --radius:16px;
    --dim:.10;
    --fz-base:clamp(14px,1.6vw,18px);
    --fz-h1:clamp(28px,8vw,70px);
    --fz-num:clamp(36px,6vw,72px);

    /* è¿›åº¦æ¡æ•´ä½“ä¸ä¸Šæ–¹æ–‡æ¡ˆçš„é—´è·ï¼ˆè¶Šå°è¶Šé ä¸Šï¼‰ */
    --season-offset: clamp(12px, 6vh, 96px);
    /* å®Œæˆå final.gif å‘ä¸Šä½ç§»ï¼ˆè´Ÿå€¼=æ›´é è¿‘è¿›åº¦æ¡ï¼‰ */
    --final-up: -50px;

    /* å·¦å³ä¸¤åª GIF çš„å‚ç›´é«˜åº¦ï¼ˆç›¸å¯¹è¿›åº¦æ¡ï¼‰â€”â€”åˆ†åˆ«å¯è°ƒ */
    --dog-top: -28px;   /* å°ç‹—æ›´é«˜ä¸€ç‚¹ */
    --end-top: -50px;   /* å³ä¾§ç»ˆç‚¹ç•¥ä½ä¸€ç‚¹ä»¥å¯¹é½è§†è§‰ */
    --end-right: -4px;  /* ç»ˆç‚¹æ°´å¹³å‘å³å¾®æº¢å‡ºï¼š0=é½å¹³ï¼Œè´Ÿå€¼=æ›´é å¤– */
  }

  html,body{
    margin:0;padding:0;background:#0b0f16;color:var(--text);
    font:var(--fz-base)/1.55 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Noto Sans SC","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif
  }

  /* èƒŒæ™¯ */
  #bg{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;object-position:center 35%;z-index:0}
  .veil{position:fixed;inset:0;background:rgba(0,0,0,var(--dim));z-index:1;pointer-events:none}
  .glow{position:fixed;inset:-25vh -25vw;filter:blur(70px) opacity(.75);z-index:2;pointer-events:none;
    background:
      radial-gradient(40% 40% at 20% 20%, rgba(255,154,162,.20), transparent 60%),
      radial-gradient(45% 45% at 85% 25%, rgba(156,217,255,.20), transparent 60%),
      radial-gradient(50% 50% at 18% 80%, rgba(168,230,207,.18), transparent 60%),
      radial-gradient(55% 55% at 75% 85%, rgba(199,206,255,.18), transparent 60%);}

  /* å¸ƒå±€ */
  .wrap{ position:relative;z-index:3;max-width:1120px;margin:0 auto;
    padding:28px 22px 18px; min-height:100svh; display:flex;flex-direction:column; }
  h1{margin:0 0 10px;font-size:var(--fz-h1);letter-spacing:.3px;text-shadow:0 2px 10px rgba(0,0,0,.35)}

  /* é¡ºåºï¼šæ ‡é¢˜(0) â†’ å›ç­”(1) â†’ é¢æ¿(2) â†’ è§é¢æ–‡æ¡ˆ(3) â†’ å­£èŠ‚è¿›åº¦(4) â†’ åº•éƒ¨å½“å‰æ—¶é—´(99) */
  #summary{order:1}
  .panel   {order:2}
  #targetline{order:3}
  .season-wrap{order:4}
  #nowline{order:99;margin-top:20px;padding:10px 16px 8px}

  .sub{color:var(--muted);margin:6px 0 10px;text-shadow:0 2px 8px rgba(0,0,0,.30)}
  .panel{margin-top:clamp(24px,4vh,120px)}
  .panel{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px}
  .card{position:relative;background:var(--glass);backdrop-filter:blur(2px);border-radius:var(--radius);padding:18px;text-align:center;box-shadow:var(--shadow)}
  .card::before{content:"";position:absolute;inset:0;border-radius:inherit;padding:1.2px;
    background:conic-gradient(from 180deg,#ff9aa2,#ffdac1,#e2f0cb,#a8e6cf,#9cd9ff,#c7ceff,#ff9aa2);
    -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;opacity:.75;pointer-events:none}
  .num{font-variant-numeric:tabular-nums;letter-spacing:.5px;font-size:var(--fz-num);font-weight:900;margin-bottom:6px;text-shadow:0 1px 6px rgba(0,0,0,.25)}
  .label{opacity:.95}

  .summary{
    margin-top:8px;font-variant-numeric:tabular-nums;
    text-shadow:0 2px 8px rgba(0,0,220,.28);
    font-size:clamp(22px,5.8vw,64px);font-weight:900;line-height:1.18;letter-spacing:.3px;
  }
  .emoji-blue{ display:inline-block;filter:hue-rotate(235deg) saturate(180%) brightness(1.06);
    -webkit-filter:hue-rotate(235deg) saturate(180%) brightness(1.06);transform:translateY(2px); }
  #summary.done{ font-size:clamp(28px,8vw,88px); }

  .panel .card:nth-child(-n+4){ background:rgba(0,0,0,.02); backdrop-filter:blur(1.2px) }
  .panel .card:nth-child(-n+4)::before{ opacity:.45 }

  #targetline{
    font-size:clamp(20px,5vw,42px); font-weight:900; letter-spacing:.3px; line-height:1.2;
    text-shadow:0 2px 10px rgba(70,140,255,.35); margin-top:clamp(32px,8vh,96px);
  }

  .title-2lines{ line-height:1.1; margin:0 0 12px; text-shadow:0 2px 10px rgba(0,0,0,.35); }
  .h1-line1{ display:block; font-size:clamp(18px,3.8vw,28px); font-weight:700; letter-spacing:.2px; opacity:.92; }
  .h1-line2{ display:block; font-size:var(--fz-h1); font-weight:900; letter-spacing:.3px; margin-top:6px; }

  :root{ --hero-offset: clamp(32px, 6vh, 200px); }
  .title-2lines{ margin-top: var(--hero-offset) !important; }

  #nowline{
    position:fixed; right:12px; bottom:12px; z-index:4; order:initial !important;
    margin:0 !important; padding:6px 10px; background:rgba(0,0,0,.28);
    backdrop-filter:blur(6px); border-radius:12px; box-shadow:var(--shadow);
    color:var(--muted); font-size:13px; line-height:1.3;
  }
  @media (min-width:768px){ #nowline{ font-size:14px } }

  .fit1{ white-space:nowrap; overflow:hidden; text-overflow:clip; display:block; width:100%; }

  /* â€”â€” ç«‹å†¬â†’å†¬è‡³ è¿›åº¦æ¡ â€”â€” */
  .season-wrap{
    position:relative; z-index:5; margin-top:var(--season-offset);
    display:flex; flex-direction:column; gap:10px;
  }
  /* æœªå®Œæˆæ—¶é¡ºåºï¼šæ¡ â†’ æ ‡ç­¾æ–‡æ¡ˆ â†’ final */
  .season-bar   { order:1; }
  .season-ends  { order:2; }
  .season-final { order:3; }

  /* å®Œæˆæ€ï¼šfinal åœ¨ä¸Šï¼Œè¿›åº¦æ¡å±…ä¸­ï¼Œæ–‡æ¡ˆåœ¨ä¸‹ï¼›å¹¶éšè—ä¸¤åª GIF */
  .season-wrap.done .season-final { order:1; display:block; }
  .season-wrap.done .season-bar   { order:2; }
  .season-wrap.done .season-ends  { order:3; }
  .season-wrap.done .season-dog,
  .season-wrap.done .season-end   { display:none !important; }

  .season-bar{
    position:relative; height:18px; border-radius:999px;
    overflow:visible; background:#ffffff1a; box-shadow:var(--shadow); z-index:1;
  }
  .season-fill{
    position:absolute; inset:0 auto 0 0; width:0;
    background: linear-gradient(90deg,#9cd9ff,#c7ceff,#ff9aa2);
    clip-path: inset(0 0 0 0 round 999px); z-index:0;
  }
  .season-percent{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:13px; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.45);
    pointer-events:none; user-select:none; z-index:1;
  }

  /* ä¸¤åª GIFï¼šå„è‡ªç‹¬ç«‹é«˜åº¦ï¼Œæ”¾åœ¨æ¡â€œä¸Šæ–¹â€ */
  .season-dog{
    position:absolute; top:var(--dog-top); left:0; transform:translateX(-50%);
    width:44px; height:auto; z-index:2; pointer-events:none;
    filter:drop-shadow(0 8px 16px rgba(0,0,0,.45));
    animation:season-bounce .9s ease-in-out infinite;
  }
  .season-end{
    position:absolute; top:var(--end-top); right:var(--end-right);
    width:62px; height:auto; z-index:2; pointer-events:none;  /* 1.4Ã— æ”¾å¤§ */
    filter:drop-shadow(0 8px 16px rgba(0,0,0,.35));
  }
  @keyframes season-bounce{ 0%,100%{ transform:translate(-50%,0) } 50%{ transform:translate(-50%,-6px) } }

  /* å·¦å³æ ‡ç­¾æ–‡æ¡ˆï¼šå·¦å³é¡¶æ ¼å¯¹é½ */
  .season-ends{
    width:100%; display:flex; justify-content:space-between; align-items:center;
    margin:8px 2px 0; color:var(--muted); font-size:.95em;
  }

  /* å®Œæˆæ—¶çš„æœ€ç»ˆ GIFï¼ˆå±…ä¸­å¹¶ä¸Šç§»ä¸€ç‚¹ï¼‰ */
  .season-final{
    display:none; margin:30px auto 0; width:180px; height:auto;   /* å¯è°ƒå¤§å° */
    position:relative; top: var(--final-up);
    filter:drop-shadow(0 12px 28px rgba(0,0,0,.45));
  }
</style>
</head>
<body>
  <!-- é»˜è®¤èƒŒæ™¯ -->
  <img id="bg" src="assets/default-bg.jpg" alt="">
  <div class="veil"></div>
  <div class="glow"></div>

  <div class="wrap">
    <h1 class="title-2lines">
      <span class="h1-line1">é‚£ä¹ˆ</span>
      <span class="h1-line2 fit1">è¿˜è¦å¤šä¹…æˆ‘æ‰èƒ½åœ¨ä»–èº«è¾¹ï¼Ÿ</span>
    </h1>

    <div id="summary" class="summary fit1"></div>
    <div id="panel" class="panel"></div>
    <div id="targetline" class="sub fit1"></div>

    <!-- ç«‹å†¬â†’å†¬è‡³ Â· å­£èŠ‚è¿›åº¦ -->
    <section class="season-wrap" id="seasonWrap">
      <div class="season-bar" id="seasonBar">
        <div class="season-fill" id="seasonFill"></div>
        <div class="season-percent" id="seasonPct">0%</div>
        <img class="season-dog" id="seasonDog" src="assets/laiicon.gif" alt="å°ç‹—å‘å³å¥”è·‘">
        <img class="season-end" id="seasonEnd" src="assets/zongicon.gif" alt="ç»ˆç‚¹ç­‰å¾…">
      </div>
      <div class="season-ends" id="seasonEnds">
        <span>ç«‹å†¬ï¼Œè‹é»ä¸–</span>
        <span>å†¬è‡³ï¼Œæˆéƒ½</span>
      </div>
      <img class="season-final" id="seasonFinal" src="assets/final.gif" alt="å®Œæˆ">
    </section>

    <div id="nowline" class="sub"></div>
  </div>

  <!-- èƒŒæ™¯éŸ³ä¹ï¼ˆæ— æŒ‰é’®ï¼Œå°½é‡è‡ªåŠ¨ + è§¦æ‘¸å³æ’­ï¼‰ -->
  <audio id="bgm" preload="auto" loop playsinline muted>
    <source src="assets/longdistance.mp3" type="audio/mpeg">
  </audio>

<script>
/* ===== å•è¡Œè‡ªé€‚åº”å­—å· ===== */
function fitOneLine(el, minPx, maxPx){
  if(!el) return;
  el.style.fontSize = maxPx + 'px';
  el.style.lineHeight = '1.15';
  if (el.scrollWidth <= el.clientWidth) return;
  let lo=minPx, hi=maxPx, mid;
  for(let i=0;i<12 && lo<=hi;i++){
    mid = (lo+hi)>>1;
    el.style.fontSize = mid + 'px';
    if (el.scrollWidth <= el.clientWidth) lo = mid + 1;
    else hi = mid - 1;
  }
  el.style.fontSize = Math.max(minPx, hi) + 'px';
}
function applyFits(){
  fitOneLine(document.querySelector('.h1-line2.fit1'), 18, 72);
  fitOneLine(document.getElementById('summary'),       16, 64);
  const t = document.getElementById('targetline');
  if (t && t.offsetParent !== null) { fitOneLine(t, 14, 44); }
}
window.addEventListener('resize', applyFits);
window.addEventListener('orientationchange', applyFits);

/* ===== å€’è®¡æ—¶ï¼ˆæœ€å¤§å•ä½ï¼šå¤©ï¼‰ ===== */
const TZ = 'Asia/Shanghai';
let TARGET = new Date('2025-12-21T09:00:00+08:00').getTime();

// ?demo=soon / ?demo=done ä¾¿äºæµ‹è¯•
const q = new URLSearchParams(location.search);
const demo = q.get('demo');
if (demo === 'soon') TARGET = Date.now() + 2000;
else if (demo === 'done') TARGET = Date.now() - 1;

function pad(n){ return String(n).padStart(2,'0'); }
function nowInZoneParts(zone){
  const f = new Intl.DateTimeFormat('en-CA', {
    timeZone: zone, year:'numeric', month:'2-digit', day:'2-digit',
    hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
  });
  const ps = f.formatToParts(new Date());
  const m = {};
  for (const p of ps) if (p.type !== 'literal') m[p.type] = +p.value;
  return { Y:m.year, M:m.month, D:m.day, h:m.hour, min:m.minute, s:m.second };
}
function split(ms){
  if(ms<=0)return{d:0,h:0,m:0,s:0,done:true};
  let t=Math.floor(ms/1000);
  const d=Math.floor(t/86400); t%=86400;
  const h=Math.floor(t/3600);  t%=3600;
  const m=Math.floor(t/60);    t%=60;
  return{d,h,m,s:t,done:false};
}

/* â€”â€” ç«‹å†¬â†’å†¬è‡³ Â· è¿›åº¦æ¡ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰â€”â€” */
const LIDONG_START = new Date('2025-11-07T17:05:00+08:00').getTime();
const DONGZHI_END  = new Date('2025-12-21T23:03:00+08:00').getTime();

const _sWrap = document.getElementById('seasonWrap');
const _sBar  = document.getElementById('seasonBar');
const _sFill = document.getElementById('seasonFill');
const _sDog  = document.getElementById('seasonDog');
const _sEnd  = document.getElementById('seasonEnd');
const _sPct  = document.getElementById('seasonPct');
const _sEnds = document.getElementById('seasonEnds');
const _sFinal= document.getElementById('seasonFinal');

function clamp01(x){ return x<0?0:x>1?1:x; }

/* é˜²é‡å æ›´æ–° */
function updateSeason(){
  if(!_sBar || !_sFill || !_sDog || !_sEnd || !_sPct) return;

  const span = Math.max(1, DONGZHI_END - LIDONG_START);
  const rawP = clamp01((Date.now() - LIDONG_START) / span);

  // ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼ˆ1 ä½å°æ•°ï¼‰
  const pct = Math.min(100, Math.max(0, rawP*100));
  _sPct.textContent = pct.toFixed(1) + '%';

  // è®¡ç®—åƒç´ ä½ç½®å¹¶é˜²ç¢°æ’
  const barW = _sBar.clientWidth || 1;
  const dogW = _sDog.offsetWidth || 44;
  const endW = _sEnd.offsetWidth || 62;
  const END_RIGHT_OFFSET = 6;     // .season-end çš„ right:-6pxï¼ˆå‘å†…ï¼‰
  const SAFE_GAP = 8;             // å®‰å…¨é—´è·

  const endLeft = barW - endW - END_RIGHT_OFFSET;         // ç»ˆç‚¹å·¦è¾¹ç•Œ
  const maxDogCenter = Math.max(dogW/2, endLeft - SAFE_GAP - dogW/2);
  let dogCenter = rawP * barW;
  dogCenter = Math.min(Math.max(dogW/2, dogCenter), maxDogCenter);

  _sFill.style.width = pct + '%';                          // å¡«å……ç…§çœŸå®è¿›åº¦èµ°åˆ° 100%
  _sDog.style.left   = (dogCenter / barW * 100) + '%';     // å°ç‹—ä½ç½®ï¼ˆä¸­å¿ƒç‚¹ï¼‰
}
window.addEventListener('resize', updateSeason);

/* ===== ä¸»æ¸²æŸ“ ===== */
function render(){
  const left = split(TARGET - Date.now());
  const z = nowInZoneParts(TZ);

  const summaryEl = document.getElementById('summary');
  const targetEl  = document.getElementById('targetline');

  if (left.done) {
    summaryEl.innerHTML = 'å°±æ˜¯ç°åœ¨ï¼åˆ°ä»–èº«è¾¹å•¦ <span class="emoji-blue" role="img" aria-label="revolving hearts">ğŸ’</span>';
    summaryEl.classList.add('done');

    if (targetEl) { targetEl.textContent = ''; targetEl.style.display = 'none'; }

    // å®Œæˆæ€ï¼šæ¡ä¿ç•™ï¼Œfinal å‡ºç°ï¼Œä¸¤åª GIF éšè—
    if (_sWrap) _sWrap.classList.add('done');

    updateSeason();
    if (_sBar)  _sBar.style.display = 'block';
    if (_sEnds) _sEnds.style.display = 'flex';
    if (_sFinal) _sFinal.style.display = 'block';

  } else {
    summaryEl.textContent = `å€’è®¡æ—¶ï¼š ${left.d} å¤© ${left.h} å°æ—¶ ${left.m} åˆ†é’Ÿ ${left.s} ç§’`;
    summaryEl.classList.remove('done');

    if (targetEl) { targetEl.style.display = 'block'; targetEl.textContent = 'æˆ‘ä»¬åœ¨æˆéƒ½è§é¢å§ï¼'; }

    if (_sWrap) _sWrap.classList.remove('done');

    updateSeason();
    if (_sBar)  _sBar.style.display = 'block';
    if (_sEnds) _sEnds.style.display = 'flex';
    if (_sFinal) _sFinal.style.display = 'none';
  }

  // å€’è®¡æ—¶å¡ç‰‡
  const p = document.getElementById('panel'); 
  p.innerHTML='';
  const add=(n,l)=>{const c=document.createElement('div');c.className='card';c.innerHTML=`<div class="num">${n}</div><div class="label">${l}</div>`;p.appendChild(c);};
  add(left.d,'å¤©'); add(left.h,'å°æ—¶'); add(left.m,'åˆ†é’Ÿ'); add(left.s,'ç§’');

  // å³ä¸‹è§’å½“å‰æ—¶é—´
  document.getElementById('nowline').textContent =
    `ä»–çš„æ—¶é—´ï¼š${z.Y}.${pad(z.M)}.${pad(z.D)} ${pad(z.h)}:${pad(z.min)}:${pad(z.s)}`;

  applyFits();
}
render();
setInterval(render,1000);
window.addEventListener('DOMContentLoaded', applyFits);

/* ===== BGMï¼šå°½é‡è‡ªåŠ¨ + ä¸€è§¦å³æ’­ï¼ˆå«å¾®ä¿¡ï¼‰ ===== */
(function(){
  const bgm = document.getElementById('bgm');
  if(!bgm) return;

  const FADE_IN_MS  = 1600;
  const FADE_OUT_MS = 800;
  const TARGET_VOL  = 0.35;
  const START_MARGIN = 5;
  let started = false;

  const sleep = ms => new Promise(r=>setTimeout(r,ms));
  async function fadeTo(target, ms){
    const start = bgm.volume;
    const steps = Math.max(1, Math.round(ms/16));
    for(let i=1;i<=steps;i++){
      bgm.volume = +(start + (target-start)*i/steps).toFixed(3);
      await sleep(ms/steps);
    }
    bgm.volume = target;
  }
  function waitMetaWithTimeout(ms=800){
    return new Promise(resolve=>{
      let done=false;
      const on=()=>{ if(!done){done=true; bgm.removeEventListener('loadedmetadata',on); resolve();}};
      bgm.addEventListener('loadedmetadata', on, {once:true});
      setTimeout(on, ms);
    });
  }

  (async()=>{ try{ await bgm.play(); }catch(e){} })(); // é™éŸ³é¢„çƒ­

  async function startFromRandom(){
    if (started) return;
    await waitMetaWithTimeout(800);
    const dur = isFinite(bgm.duration) ? bgm.duration : 0;
    const max = Math.max(0, dur - START_MARGIN);
    const t   = (max>0) ? Math.random()*max : 0;
    try{ bgm.currentTime = t; }catch(e){}
    try{ bgm.muted = false; }catch(e){}
    bgm.volume = 0;
    await bgm.play().catch(()=>{});
    await fadeTo(TARGET_VOL, FADE_IN_MS);
    started = true;
  }

  async function pauseWithFade(){
    await fadeTo(0, FADE_OUT_MS);
    bgm.pause();
    started = false;
  }

  const offs=[]; const on=(el,ev,fn,opt)=>{ el.addEventListener(ev,fn,opt); offs.push(()=>el.removeEventListener(ev,fn,opt)); };
  const offAll=()=>offs.splice(0).forEach(fn=>fn());
  const unlock=async()=>{ offAll(); await startFromRandom(); };

  document.addEventListener('WeixinJSBridgeReady', unlock, {once:true});
  if (window.wx && typeof wx.ready==='function'){ try{ wx.ready(unlock); }catch(e){} }
  document.addEventListener('pointerdown', unlock, {once:true});
  document.addEventListener('touchstart', unlock, {once:true});
  document.addEventListener('click', unlock, {once:true});
  document.addEventListener('keydown', unlock, {once:true});

  document.addEventListener('visibilitychange', async ()=>{
    if (document.hidden){
      if (!bgm.paused) await pauseWithFade();
    }else{
      try{ bgm.muted = false; }catch(e){}
      bgm.volume = 0;
      await bgm.play().catch(()=>{});
      await fadeTo(TARGET_VOL, FADE_IN_MS);
      started = true;
    }
  });
})();
</script>
</body>
</html>




